process:
  id: event_subprocess_timer_demo
  name: Event Sub-Process - Timer Example

  pools:
    - id: pool1
      name: Order Processing Pool
      x: 50
      y: 100
      width: 1400
      height: 600
      lanes:
        - id: lane1
          name: Main Process
          height: 300
        - id: lane2
          name: Escalation Handling
          height: 300

  elements:
    # Main Process Flow
    - id: start1
      type: startEvent
      name: Start Order
      x: 150
      y: 200
      poolId: pool1
      laneId: lane1

    - id: task_receive_order
      type: scriptTask
      name: Receive Order
      x: 300
      y: 170
      poolId: pool1
      laneId: lane1
      properties:
        scriptFormat: python
        script: |
          import time
          print(f"\nüì¶ Receiving order: {order_id}")
          print(f"   Customer: {customer_name}")
          print(f"   Amount: ${order_amount}")
          time.sleep(1)
          order_received = True
          print("‚úÖ Order received")

    - id: task_process_order
      type: scriptTask
      name: Process Order (Long Running)
      x: 500
      y: 170
      poolId: pool1
      laneId: lane1
      properties:
        scriptFormat: python
        script: |
          import time
          print(f"\n‚öôÔ∏è  Processing order: {order_id}")
          print("   This will take 15 seconds...")

          # Simulate long-running processing
          for i in range(15):
            time.sleep(1)
            print(f"   Progress: {((i+1)/15*100):.0f}%")

          order_status = "processed"
          print("‚úÖ Order processing complete")

    - id: task_ship_order
      type: scriptTask
      name: Ship Order
      x: 700
      y: 170
      poolId: pool1
      laneId: lane1
      properties:
        scriptFormat: python
        script: |
          import time
          print(f"\nüöö Shipping order: {order_id}")
          time.sleep(1)
          shipping_status = "shipped"
          print("‚úÖ Order shipped")

    - id: end1
      type: endEvent
      name: Order Complete
      x: 900
      y: 200
      poolId: pool1
      laneId: lane1

    # Event Sub-Process (Timer) - Triggers after 5 seconds
    # The subprocess container with dashed border
    - id: event_subprocess_timeout
      type: eventSubProcess
      name: Timeout Escalation Handler
      x: 500
      y: 525
      poolId: pool1
      laneId: lane2
      width: 700
      height: 150
      properties:
        isInterrupting: false  # Non-interrupting - runs in parallel
      childElements:
        # Child element coordinates are RELATIVE to subprocess center (0, 0)
        # Subprocess is at (500, 525), so children are offset from that point
        - id: esp_timer_start
          type: timerStartEvent
          name: After 5s
          x: -280
          y: 0
          poolId: pool1
          laneId: lane2
          properties:
            timerDuration: PT5S  # 5 seconds

        - id: esp_task_send_reminder
          type: scriptTask
          name: Send Escalation Notice
          x: -120
          y: -5
          poolId: pool1
          laneId: lane2
          properties:
            scriptFormat: python
            script: |
              import time
              print("\n" + "="*60)
              print("‚ö†Ô∏è  ESCALATION: Order processing is taking too long!")
              print("="*60)
              print(f"   Order ID: {order_id}")
              print(f"   Customer: {customer_name}")
              print(f"   Time elapsed: >5 seconds")
              print("   Action: Sending escalation notification to supervisor")
              time.sleep(1)
              escalation_sent = True
              print("‚úÖ Escalation notice sent")
              print("="*60)

        - id: esp_task_log_escalation
          type: scriptTask
          name: Log Escalation
          x: 100
          y: -5
          poolId: pool1
          laneId: lane2
          properties:
            scriptFormat: python
            script: |
              import time
              print(f"\nüìù Logging escalation event for order {order_id}")
              escalation_log = {
                'order_id': order_id,
                'timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
                'reason': 'Processing timeout exceeded 5 seconds'
              }
              print(f"   Log entry created: {escalation_log}")

        - id: esp_end
          type: endEvent
          name: Escalation Complete
          x: 280
          y: 0
          poolId: pool1
          laneId: lane2

      childConnections:
        - id: esp_conn1
          from: esp_timer_start
          to: esp_task_send_reminder

        - id: esp_conn2
          from: esp_task_send_reminder
          to: esp_task_log_escalation

        - id: esp_conn3
          from: esp_task_log_escalation
          to: esp_end

  connections:
    - id: conn1
      from: start1
      to: task_receive_order

    - id: conn2
      from: task_receive_order
      to: task_process_order

    - id: conn3
      from: task_process_order
      to: task_ship_order

    - id: conn4
      from: task_ship_order
      to: end1
